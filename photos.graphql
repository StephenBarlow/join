
schema
  @core(feature: "https://lib.apollo.dev/core/v1.0")
  @core(feature: "https://lib.apollo.dev/join/v1.0")
  @core(feature: "https://lib.apollo.dev/error/v1.0")
{
  query: Query
}


directive @core(feature: String!)
  repeatable on SCHEMA

directive @join__type(
  graph: join__Graph,
  requires: ref__Fragment,
  provides: ref__Fragment)
  on
  | OBJECT
  | INTERFACE

directive @join__field(
  graph: join__Graph,
  requires: ref__Fragment,
  provides: ref__Fragment)
  on
  | FIELD_DEFINITION

directive @error(join: join__Error)
  on
  | OBJECT
  | INTERFACE
  | UNION
  | FIELD_DEFINITION

input join__Error {
  fieldsConflictInSubgraphs: [join__Graph!]!
}

enum join__Graph {
  AUTH,
  ALBUMS,
  IMAGES
}

scalar join__Never

type Query
  @join__type(graph: AUTH)
  @join__type(graph: IMAGES)
{
  me: User        @join__field(graph: AUTH)
  images: [Image] @join__field(graph: IMAGES)
}

type User
  @join__owner(graph: AUTH)
  @join__type(graph: AUTH, key: "ref___User_id")
  @join__type(graph: ALBUMS, key: "ref___User_id")
{
  id: ID                  @join__field(graph: AUTH)
  name: String            @join__field(graph: AUTH)
  albums: [Album!]        @join__field(graph: ALBUMS)
  favorite: join__Never   @error(join: {
                            fieldsConflictInSubgraphs: [ALBUMS, IMAGES]
                          })
}

fragment ref___User_id on User {
  id
}

type Album @join(graph: ALBUMS) {
  user: User
  photos: [Image!]
}

type Image
  @join__owner(graph: IMAGES)
  @join__type(graph: ALBUMS, key: "ref___Image_url")
  @join__type(graph: IMAGES, key: "ref___Image_url")
{
  url: Url          @join__field(graph: IMAGES)
  type: MimeType    @join__field(graph: IMAGES)
  albums: [Album!]  @join__field(graph: ALBUMS)
}

# This fragment is an Image key within the IMAGE
# and ALBUMS graphs.
#
# The fragment name is arbitrary. The only constraint
# is that it must be unique within the document.
fragment ref___Image_url on Image
{
  url
}

scalar Url
scalar MimeType